# Best Practices to Manage Instances with AWS SSM

## Automation

Create self-service Automation runbooks for infrastructure.

Use Automation, a tool in AWS Systems Manager, to simplify creating Amazon Machine Images (AMIs) from the AWS Marketplace or custom AMIs, using public Systems Manager documents (SSM documents) or by authoring your own workflows.

Build and maintain AMIs using the AWS-UpdateLinuxAmi and AWS-UpdateWindowsAmi Automation runbooks, or using custom Automation runbooks that you create.

## Inventory

Use Inventory, a tool in AWS Systems Manager, with AWS Config to audit your application configurations over time.

## Maintenance Windows

Define a schedule to perform potentially disruptive actions on your nodes such as operating system (OS) patching, driver updates, or software installations.

For information about the differences between State Manager and Maintenance Windows, tools of AWS Systems Manager, see [Choosing between State Manager and Maintenance Windows](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-maintenance.html).

## Parameter Store

Use Parameter Store, a tool in AWS Systems Manager, to centrally manage global configuration settings.

- How AWS Systems Manager Parameter Store uses AWS KMS.
- Reference AWS Secrets Manager secrets from Parameter Store parameters.

## Patch Manager

Use Patch Manager, a tool in AWS Systems Manager, to roll out patches at scale and increase fleet compliance visibility across your nodes.

- Integrate Patch Manager with AWS Security Hub to receive alerts when nodes in your fleet go out of compliance and monitor the patching status of your fleets from a security point of view. There is a charge to use Security Hub. For more information, see [Pricing](https://aws.amazon.com/security-hub/pricing/).
- Use only one method at a time for scanning managed nodes for patch compliance to avoid unintentionally overwriting compliance data.

## Run Command

Manage Instances at Scale without SSH Access Using EC2 Run Command.

- Audit all API calls made by or on behalf of Run Command, a tool in AWS Systems Manager, using AWS CloudTrail.
- When you send a command using Run Command, don't include sensitive information formatted as plaintext, such as passwords, configuration data, or other secrets. All Systems Manager API activity in your account is logged in an S3 bucket for AWS CloudTrail logs. This means that any user with access to S3 bucket can view the plaintext values of those secrets. For this reason, we recommend creating and using SecureString parameters to encrypt sensitive data you use in your Systems Manager operations.
- Use the targets and rate control features in Run Command to perform a staged command operation.
- Use fine-grained access permissions for Run Command (and all Systems Manager tools) by using AWS Identity and Access Management (IAM) policies.

## Session Manager

- Log session activity in your AWS account using AWS CloudTrail.
- Log session data in your AWS account using Amazon CloudWatch Logs or Amazon S3.
- Control user session access to instances.
- Restrict access to commands in a session.
- Turn off or turn on ssm-user account administrative permissions.

## State Manager

- Update SSM Agent at least once a month using the pre-configured AWS-UpdateSSMAgent document.
- (Windows) Upload the PowerShell or DSC module to Amazon Simple Storage Service (Amazon S3), and use AWS-InstallPowerShellModule.
- Use tags to create application groups for your nodes. And then target nodes using the Targets parameter instead of specifying individual node IDs.
- Automatically remediate findings generated by Amazon Inspector by using Systems Manager.
- Use a centralized configuration repository for your SSM documents, and share documents across your organization.

For information about the differences between State Manager and Maintenance Windows, see [Choosing between State Manager and Maintenance Windows](https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-maintenance.html).
